<Window x:Class="WpfInteractionApp.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Application Settings" Height="500" Width="600"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource Carbon.Brush.Background.Primary}"
        Foreground="{DynamicResource Carbon.Brush.Text.Primary}"
        Style="{DynamicResource Carbon.Window}">
    
    <Window.Resources>
        <!-- Modern Card Style for Settings Sections -->
        <Style x:Key="SettingsCard" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource Carbon.Brush.Background.Secondary}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Carbon.Brush.Background.Tertiary}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" Opacity="0.08" BlurRadius="8" ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Card Header Style -->
        <Style x:Key="CardHeader" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{DynamicResource Carbon.Brush.Text.Primary}"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
        </Style>

        <!-- Form Field Container -->
        <Style x:Key="FieldContainer" TargetType="StackPanel">
            <Setter Property="Margin" Value="0,0,0,12"/>
        </Style>

        <!-- Field Label Style -->
        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="{DynamicResource Carbon.Brush.Text.Primary}"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
        </Style>

        <!-- Enhanced TextBox Style -->
        <Style TargetType="TextBox" BasedOn="{StaticResource Carbon.TextBox}">
            <Setter Property="MinHeight" Value="32"/>
            <Setter Property="Padding" Value="12,8"/>
        </Style>

        <!-- Enhanced CheckBox Style -->
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{DynamicResource Carbon.Brush.Text.Primary}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Margin" Value="0,0,12,0"/>
        </Style>

        <!-- Info Text Style -->
        <Style x:Key="InfoText" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{DynamicResource Carbon.Brush.Text.Secondary}"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="Margin" Value="0,8,0,0"/>
        </Style>
    </Window.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- File Paths Card -->
                <Border Style="{StaticResource SettingsCard}">
                    <StackPanel>
                        <TextBlock Text="File Paths" Style="{StaticResource CardHeader}"/>
                        
                        <StackPanel Style="{StaticResource FieldContainer}">
                            <TextBlock Text="Handlers File" Style="{StaticResource FieldLabel}"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="HandlersFilePathTextBox" 
                                         Text="{Binding HandlersFilePath}"
                                         Grid.Column="0"/>
                                <Button Content="Browse..." 
                                        Grid.Column="1"
                                        Margin="8,0,0,0" 
                                        Click="BrowseHandlersFile_Click"
                                        Style="{DynamicResource Carbon.Button.Secondary}"/>
                            </Grid>
                        </StackPanel>
                        
                        <StackPanel Style="{StaticResource FieldContainer}">
                            <TextBlock Text="Plugins Directory" Style="{StaticResource FieldLabel}"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="PluginsDirTextBox" 
                                         Text="{Binding PluginsDirectory}"
                                         Grid.Column="0"/>
                                <Button Content="Browse..." 
                                        Grid.Column="1"
                                        Margin="8,0,0,0" 
                                        Click="BrowsePluginsDir_Click"
                                        Style="{DynamicResource Carbon.Button.Secondary}"/>
                            </Grid>
                        </StackPanel>
                        
                        <StackPanel Style="{StaticResource FieldContainer}">
                            <TextBlock Text="Exchange Directory" Style="{StaticResource FieldLabel}"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="ExchangeDirTextBox" 
                                         Text="{Binding ExchangeDirectory}"
                                         Grid.Column="0"/>
                                <Button Content="Browse..." 
                                        Grid.Column="1"
                                        Margin="8,0,0,0" 
                                        Click="BrowseExchangeDir_Click"
                                        Style="{DynamicResource Carbon.Button.Secondary}"/>
                            </Grid>
                        </StackPanel>
                        
                        <TextBlock Text="Configure file paths for handlers, plugins, and exchange directory. These paths determine where the application looks for configuration files and extensions."
                                   Style="{StaticResource InfoText}"/>
                    </StackPanel>
                </Border>

                <!-- Keyboard Shortcut Card -->
                <Border Style="{StaticResource SettingsCard}">
                    <StackPanel>
                        <TextBlock Text="Keyboard Shortcut" Style="{StaticResource CardHeader}"/>
                        
                        <StackPanel Style="{StaticResource FieldContainer}">
                            <TextBlock Text="Modifier Keys" Style="{StaticResource FieldLabel}"/>
                            <StackPanel Orientation="Horizontal">
                                <CheckBox Content="Ctrl" 
                                         IsChecked="{Binding IsCtrlChecked}"
                                         Style="{DynamicResource Carbon.CheckBox}"
                                         Foreground="{DynamicResource Carbon.Brush.Text.Primary}"
                                         Margin="0,0,16,0"/>
                                <CheckBox Content="Alt" 
                                         IsChecked="{Binding IsAltChecked}"
                                         Style="{DynamicResource Carbon.CheckBox}"
                                         Foreground="{DynamicResource Carbon.Brush.Text.Primary}"
                                         Margin="0,0,16,0"/>
                                <CheckBox Content="Shift" 
                                         IsChecked="{Binding IsShiftChecked}"
                                         Style="{DynamicResource Carbon.CheckBox}"
                                         Foreground="{DynamicResource Carbon.Brush.Text.Primary}"
                                         Margin="0,0,16,0"/>
                                <CheckBox Content="Win" 
                                         IsChecked="{Binding IsWinChecked}"
                                         Style="{DynamicResource Carbon.CheckBox}"
                                         Foreground="{DynamicResource Carbon.Brush.Text.Primary}"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <StackPanel Style="{StaticResource FieldContainer}">
                            <TextBlock Text="Key" Style="{StaticResource FieldLabel}"/>
                            <TextBox x:Name="KeyTextBox" 
                                     Text="{Binding Key}" 
                                     Width="80" 
                                     HorizontalAlignment="Left"/>
                        </StackPanel>
                        
                        <TextBlock Text="Configure the global keyboard shortcut to activate the application. Select modifier keys and specify the main key."
                                   Style="{StaticResource InfoText}"/>
                    </StackPanel>
                </Border>

                <!-- Timing Settings Card -->
                <Border Style="{StaticResource SettingsCard}">
                    <StackPanel>
                        <TextBlock Text="Timing Settings" Style="{StaticResource CardHeader}"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Clipboard Wait Timeout -->
                            <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                <TextBlock Text="Clipboard Wait Timeout" Style="{StaticResource FieldLabel}"/>
                                <StackPanel Orientation="Horizontal">
                                    <TextBox x:Name="ClipboardWaitTimeoutTextBox" 
                                             Text="{Binding ClipboardWaitTimeout}" 
                                             Width="80"/>
                                    <TextBlock Text="ms" 
                                               VerticalAlignment="Center" 
                                               Margin="6,0,0,0"
                                               Foreground="{DynamicResource Carbon.Brush.Text.Secondary}"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- Window Activation Delay -->
                            <StackPanel Grid.Column="1" Margin="0,0,12,0">
                                <TextBlock Text="Window Activation Delay" Style="{StaticResource FieldLabel}"/>
                                <StackPanel Orientation="Horizontal">
                                    <TextBox x:Name="WindowActivationDelayTextBox" 
                                             Text="{Binding WindowActivationDelay}" 
                                             Width="80"/>
                                    <TextBlock Text="ms" 
                                               VerticalAlignment="Center" 
                                               Margin="6,0,0,0"
                                               Foreground="{DynamicResource Carbon.Brush.Text.Secondary}"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- Clipboard Clear Delay -->
                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Clipboard Clear Delay" Style="{StaticResource FieldLabel}"/>
                                <StackPanel Orientation="Horizontal">
                                    <TextBox x:Name="ClipboardClearDelayTextBox" 
                                             Text="{Binding ClipboardClearDelay}" 
                                             Width="80"/>
                                    <TextBlock Text="ms" 
                                               VerticalAlignment="Center" 
                                               Margin="6,0,0,0"
                                               Foreground="{DynamicResource Carbon.Brush.Text.Secondary}"/>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                        
                        <TextBlock Text="Configure timing delays for clipboard operations and window activation. These settings help ensure reliable operation across different system configurations."
                                   Style="{StaticResource InfoText}"/>
                    </StackPanel>
                </Border>

                <!-- Config System Section -->
                <Border Style="{StaticResource SettingsCard}">
                    <StackPanel>
                        <TextBlock Text="Config System" Style="{StaticResource CardHeader}"/>
                        
                        <!-- Enable Config System -->
                        <StackPanel Style="{StaticResource FieldContainer}">
                            <CheckBox x:Name="ConfigSystemEnabledCheckBox" 
                                      Content="Enable Config Files" 
                                      IsChecked="{Binding ConfigSystem.Enabled}"
                                      Style="{DynamicResource Carbon.CheckBox}"
                                      Foreground="{DynamicResource Carbon.Brush.Text.Primary}"/>
                        </StackPanel>
                        
                        <!-- Config File Path -->
                        <StackPanel Style="{StaticResource FieldContainer}">
                            <TextBlock Text="Config File Path" Style="{StaticResource FieldLabel}"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="ConfigFilePathTextBox" 
                                         Text="{Binding ConfigSystem.ConfigFilePath}" 
                                         Grid.Column="0"
                                         Margin="0,0,8,0"/>
                                <Button Content="Browse" 
                                        Grid.Column="1" 
                                        Style="{DynamicResource Carbon.Button.Secondary}"
                                        Click="BrowseConfigFileButton_Click"
                                        MinWidth="80"/>
                            </Grid>
                        </StackPanel>
                        
                        <!-- Secrets File Path -->
                        <StackPanel Style="{StaticResource FieldContainer}">
                            <TextBlock Text="Secrets File Path" Style="{StaticResource FieldLabel}"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="SecretsFilePathTextBox" 
                                         Text="{Binding ConfigSystem.SecretsFilePath}" 
                                         Grid.Column="0"
                                         Margin="0,0,8,0"/>
                                <Button Content="Browse" 
                                        Grid.Column="1" 
                                        Style="{DynamicResource Carbon.Button.Secondary}"
                                        Click="BrowseSecretsFileButton_Click"
                                        MinWidth="80"/>
                            </Grid>
                        </StackPanel>
                        
                        <!-- Auto Create Files -->
                        <StackPanel Style="{StaticResource FieldContainer}">
                            <CheckBox x:Name="AutoCreateFilesCheckBox" 
                                      Content="Auto-create config files if they don't exist" 
                                      IsChecked="{Binding ConfigSystem.AutoCreateFiles}"
                                      Style="{DynamicResource Carbon.CheckBox}"
                                      Foreground="{DynamicResource Carbon.Brush.Text.Primary}"/>
                        </StackPanel>
                        
                        <TextBlock Text="Configure paths for config.ini and secrets.ini files. Use $config:section.key patterns in handlers (e.g., $config:api_keys.jira_api_key, $config:endpoints.jira_base_url)."
                                   Style="{StaticResource InfoText}"/>
                    </StackPanel>
                </Border>

                <!-- Network Updates Card -->
                <Border Style="{StaticResource SettingsCard}">
                    <StackPanel>
                        <TextBlock Text="Network Updates" Style="{StaticResource CardHeader}"/>
                        
                        <!-- Enable Network Updates -->
                        <StackPanel Style="{StaticResource FieldContainer}">
                            <CheckBox x:Name="EnableNetworkUpdatesCheckBox" 
                                      Content="Enable network updates" 
                                      IsChecked="{Binding UISettings.NetworkUpdateSettings.EnableNetworkUpdates}"
                                      Style="{DynamicResource Carbon.CheckBox}"
                                      Foreground="{DynamicResource Carbon.Brush.Text.Primary}"/>
                        </StackPanel>
                        
                        <!-- Network Update Path -->
                        <StackPanel Style="{StaticResource FieldContainer}">
                            <TextBlock Text="Network Update Path" Style="{StaticResource FieldLabel}"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="NetworkUpdatePathTextBox" 
                                         Text="{Binding UISettings.NetworkUpdateSettings.NetworkUpdatePath}" 
                                         Grid.Column="0"
                                         Margin="0,0,8,0"/>
                                <Button Content="Browse" 
                                        Grid.Column="1" 
                                        Style="{DynamicResource Carbon.Button.Secondary}"
                                        Click="BrowseNetworkUpdatePathButton_Click"
                                        MinWidth="80"/>
                            </Grid>
                        </StackPanel>

                        <!-- Update Script Path -->
                        <StackPanel Style="{StaticResource FieldContainer}">
                            <TextBlock Text="Update Script Path (.bat)" Style="{StaticResource FieldLabel}"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="UpdateScriptPathTextBox" 
                                         Text="{Binding UISettings.NetworkUpdateSettings.UpdateScriptPath}" 
                                         Grid.Column="0"
                                         Margin="0,0,8,0"/>
                                <Button Content="Browse" 
                                        Grid.Column="1" 
                                        Style="{DynamicResource Carbon.Button.Secondary}"
                                        Click="BrowseUpdateScriptPathButton_Click"
                                        MinWidth="80"/>
                            </Grid>
                        </StackPanel>

                        <!-- Check Interval -->
                        <StackPanel Style="{StaticResource FieldContainer}">
                            <TextBlock Text="Check Interval (hours)" Style="{StaticResource FieldLabel}"/>
                            <TextBox x:Name="CheckIntervalHoursTextBox" 
                                     Text="{Binding UISettings.NetworkUpdateSettings.CheckIntervalHours}" 
                                     Width="100"
                                     HorizontalAlignment="Left"/>
                        </StackPanel>

                        <!-- Auto Install Options -->
                        <StackPanel Style="{StaticResource FieldContainer}">
                            <CheckBox x:Name="AutoInstallNonMandatoryCheckBox" 
                                      Content="Auto-install non-mandatory updates" 
                                      IsChecked="{Binding UISettings.NetworkUpdateSettings.AutoInstallNonMandatory}"
                                      Style="{DynamicResource Carbon.CheckBox}"
                                      Foreground="{DynamicResource Carbon.Brush.Text.Primary}"/>
                        </StackPanel>

                        <StackPanel Style="{StaticResource FieldContainer}">
                            <CheckBox x:Name="AutoInstallMandatoryCheckBox" 
                                      Content="Auto-install mandatory updates" 
                                      IsChecked="{Binding UISettings.NetworkUpdateSettings.AutoInstallMandatory}"
                                      Style="{DynamicResource Carbon.CheckBox}"
                                      Foreground="{DynamicResource Carbon.Brush.Text.Primary}"/>
                        </StackPanel>
                        
                        <TextBlock Text="Configure automatic updates from a corporate network share. Updates are checked at startup and at specified intervals."
                                   Style="{StaticResource InfoText}"/>
                    </StackPanel>
                </Border>

                <!-- MCP Server Card -->
                <Border Style="{StaticResource SettingsCard}">
                    <StackPanel>
                        <TextBlock Text="MCP Server" Style="{StaticResource CardHeader}"/>

                        <StackPanel Style="{StaticResource FieldContainer}">
                            <CheckBox x:Name="McpEnabledCheckBox"
                                      Content="Enable MCP HTTP server (localhost)"
                                      IsChecked="{Binding McpSettings.Enabled}"
                                      Style="{DynamicResource Carbon.CheckBox}"
                                      Foreground="{DynamicResource Carbon.Brush.Text.Primary}"/>
                        </StackPanel>

                        <StackPanel Style="{StaticResource FieldContainer}">
                            <TextBlock Text="Port" Style="{StaticResource FieldLabel}"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBox x:Name="McpPortTextBox"
                                         Text="{Binding McpSettings.Port}"
                                         Width="100"
                                         HorizontalAlignment="Left"/>
                                <TextBlock Text="(http://127.0.0.1:&lt;port&gt;/mcp/sse)"
                                           VerticalAlignment="Center"
                                           Margin="10,0,0,0"
                                           Foreground="{DynamicResource Carbon.Brush.Text.Secondary}"/>
                            </StackPanel>
                        </StackPanel>

                        <TextBlock Text="Enable the built-in MCP server so MCP clients can call your mcp_enabled handlers as tools. Changes require application restart."
                                   Style="{StaticResource InfoText}"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <StackPanel Grid.Row="1" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right" 
                    Margin="0,10,0,0">
            <Button Content="Cancel"
                    Style="{DynamicResource Carbon.Button.Secondary}"
                    Click="CancelButton_Click"
                    MinWidth="100"
                    Margin="0,0,12,0"/>
            
            <Button Content="Save"
                    Style="{DynamicResource Carbon.Button.Base}"
                    Click="SaveButton_Click"
                    MinWidth="100"/>
        </StackPanel>
    </Grid>
</Window> 
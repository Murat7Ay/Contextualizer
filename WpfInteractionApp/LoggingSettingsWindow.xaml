<Window x:Class="WpfInteractionApp.LoggingSettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Logging Settings" Height="650" Width="700"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource Carbon.Brush.Background.Primary}"
        Foreground="{DynamicResource Carbon.Brush.Text.Primary}"
        Style="{DynamicResource Carbon.Window}">
    
    <Window.Resources>
        <Style TargetType="GroupBox">
            <Setter Property="Background" Value="{DynamicResource Carbon.Brush.Background.Secondary}"/>
            <Setter Property="Foreground" Value="{DynamicResource Carbon.Brush.Text.Primary}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Carbon.Brush.Background.Tertiary}"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Background" Value="{DynamicResource Carbon.Brush.Background.Secondary}"/>
            <Setter Property="Foreground" Value="{DynamicResource Carbon.Brush.Text.Primary}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Carbon.Brush.Background.Tertiary}"/>
            <Setter Property="Padding" Value="8,6"/>
        </Style>

        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{DynamicResource Carbon.Brush.Text.Primary}"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
        </Style>

        <Style TargetType="Label">
            <Setter Property="Foreground" Value="{DynamicResource Carbon.Brush.Text.Primary}"/>
        </Style>

        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="{DynamicResource Carbon.Brush.Background.Secondary}"/>
            <Setter Property="Foreground" Value="{DynamicResource Carbon.Brush.Text.Primary}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Carbon.Brush.Background.Tertiary}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton x:Name="ToggleButton"
                                 Background="{TemplateBinding Background}"
                                 BorderBrush="{TemplateBinding BorderBrush}"
                                 IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border x:Name="Border" 
                                         Background="{TemplateBinding Background}"
                                         BorderBrush="{TemplateBinding BorderBrush}"
                                         BorderThickness="1">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="20" />
                                                </Grid.ColumnDefinitions>
                                                <ContentPresenter Grid.Column="0"
                                                         Margin="6,3"
                                                         HorizontalAlignment="Left"
                                                         VerticalAlignment="Center" />
                                                <Path x:Name="Arrow"
                                               Grid.Column="1"
                                               Fill="{DynamicResource Carbon.Brush.Text.Primary}"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               Data="M0,0 L4,4 L8,0 Z"/>
                                            </Grid>
                                        </Border>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>
                            <ContentPresenter x:Name="ContentSite"
                                     Margin="6,3"
                                     IsHitTestVisible="False"
                                     HorizontalAlignment="Left"
                                     VerticalAlignment="Center"
                                     Content="{TemplateBinding SelectionBoxItem}"
                                     ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                     ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"/>
                            <Popup x:Name="Popup"
                            AllowsTransparency="True"
                            IsOpen="{TemplateBinding IsDropDownOpen}"
                            Placement="Bottom"
                            PopupAnimation="Slide">
                                <Grid x:Name="DropDown"
                               MinWidth="{TemplateBinding ActualWidth}"
                               MaxHeight="{TemplateBinding MaxDropDownHeight}"
                               SnapsToDevicePixels="True">
                                    <Border x:Name="DropDownBorder"
                                     Background="{DynamicResource Carbon.Brush.Background.Secondary}"
                                     BorderBrush="{DynamicResource Carbon.Brush.Background.Tertiary}"
                                     BorderThickness="1"/>
                                    <ScrollViewer SnapsToDevicePixels="True">
                                        <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Contained" />
                                    </ScrollViewer>
                                </Grid>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>


        <Style TargetType="Slider">
            <Setter Property="Foreground" Value="{DynamicResource Carbon.Brush.Text.Primary}"/>
        </Style>
    </Window.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- Local Logging Settings -->
                <GroupBox Header="Local Logging">
                    <StackPanel Margin="5">
                        <CheckBox x:Name="EnableLocalLoggingCheckBox" 
                                  Content="Enable Local Logging" 
                                  IsChecked="{Binding EnableLocalLogging}"
                                  Margin="0,5"/>
                        
                        <DockPanel Margin="0,5">
                            <Label Content="Log Directory:" Width="150"/>
                            <Button Content="Browse..." 
                                    DockPanel.Dock="Right" 
                                    Margin="5,0,0,0" 
                                    Click="BrowseLogDirectory_Click"
                                    Style="{DynamicResource Carbon.Button.Secondary}"/>
                            <TextBox x:Name="LogDirectoryTextBox" Text="{Binding LocalLogPath}"/>
                        </DockPanel>

                        <DockPanel Margin="0,5">
                            <Label Content="Minimum Log Level:" Width="150"/>
                            <ComboBox x:Name="MinimumLogLevelComboBox" 
                                      SelectedValue="{Binding MinimumLogLevel}"
                                      SelectedValuePath="Tag"
                                      Width="150" HorizontalAlignment="Left">
                                <ComboBoxItem Content="Debug" Tag="Debug"/>
                                <ComboBoxItem Content="Info" Tag="Info"/>
                                <ComboBoxItem Content="Warning" Tag="Warning"/>
                                <ComboBoxItem Content="Error" Tag="Error"/>
                                <ComboBoxItem Content="Critical" Tag="Critical"/>
                            </ComboBox>
                        </DockPanel>

                        <DockPanel Margin="0,5">
                            <Label Content="Max File Size (MB):" Width="150"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider x:Name="MaxFileSizeSlider" 
                                        Minimum="1" Maximum="50" 
                                        Value="{Binding MaxLogFileSizeMB}" 
                                        Width="200" 
                                        TickFrequency="5" 
                                        IsSnapToTickEnabled="True"/>
                                <Label Content="{Binding ElementName=MaxFileSizeSlider, Path=Value}" 
                                       ContentStringFormat="{}{0} MB" 
                                       Width="60"/>
                            </StackPanel>
                        </DockPanel>

                        <DockPanel Margin="0,5">
                            <Label Content="Max File Count:" Width="150"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider x:Name="MaxFileCountSlider" 
                                        Minimum="1" Maximum="20" 
                                        Value="{Binding MaxLogFileCount}" 
                                        Width="200" 
                                        TickFrequency="1" 
                                        IsSnapToTickEnabled="True"/>
                                <Label Content="{Binding ElementName=MaxFileCountSlider, Path=Value}" 
                                       ContentStringFormat="{}{0} files" 
                                       Width="80"/>
                            </StackPanel>
                        </DockPanel>

                        <CheckBox x:Name="EnableDebugModeCheckBox" 
                                  Content="Enable Debug Mode (Verbose Logging)" 
                                  IsChecked="{Binding EnableDebugMode}"
                                  Margin="0,5"/>
                    </StackPanel>
                </GroupBox>

                <!-- Usage Analytics Settings -->
                <GroupBox Header="Usage Analytics">
                    <StackPanel Margin="5">
                        <CheckBox x:Name="EnableUsageTrackingCheckBox" 
                                  Content="Enable Usage Analytics (Anonymous)" 
                                  IsChecked="{Binding EnableUsageTracking}"
                                  Margin="0,5"/>
                        
                        <DockPanel Margin="0,5">
                            <Label Content="Analytics Endpoint URL:" Width="150"/>
                            <TextBox x:Name="UsageEndpointUrlTextBox" 
                                     Text="{Binding UsageEndpointUrl}"
                                     IsEnabled="{Binding ElementName=EnableUsageTrackingCheckBox, Path=IsChecked}"/>
                        </DockPanel>

                        <TextBlock Text="Usage analytics help improve the application by collecting anonymous performance and usage data. No personal information is collected."
                                   TextWrapping="Wrap"
                                   Foreground="{DynamicResource Carbon.Brush.Text.Secondary}"
                                   Margin="0,10,0,0"
                                   FontSize="11"/>
                    </StackPanel>
                </GroupBox>

                <!-- Log Statistics -->
                <GroupBox Header="Log Statistics">
                    <StackPanel Margin="5">
                        <DockPanel Margin="0,5">
                            <Label Content="Current Log Directory:" Width="150"/>
                            <TextBlock x:Name="CurrentLogDirectoryText" 
                                       Text="{Binding CurrentLogDirectory}"
                                       Foreground="{DynamicResource Carbon.Brush.Text.Secondary}"
                                       VerticalAlignment="Center"/>
                        </DockPanel>

                        <DockPanel Margin="0,5">
                            <Label Content="Total Log Files:" Width="150"/>
                            <TextBlock x:Name="TotalLogFilesText" 
                                       Text="{Binding TotalLogFiles}"
                                       Foreground="{DynamicResource Carbon.Brush.Text.Secondary}"
                                       VerticalAlignment="Center"/>
                        </DockPanel>

                        <DockPanel Margin="0,5">
                            <Label Content="Total Log Size:" Width="150"/>
                            <TextBlock x:Name="TotalLogSizeText" 
                                       Text="{Binding TotalLogSize}"
                                       Foreground="{DynamicResource Carbon.Brush.Text.Secondary}"
                                       VerticalAlignment="Center"/>
                        </DockPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <Button Content="Open Log Folder" 
                                    Click="OpenLogFolder_Click"
                                    Style="{DynamicResource Carbon.Button.Secondary}"
                                    Margin="0,0,10,0"/>
                            <Button Content="Clear Old Logs" 
                                    Click="ClearOldLogs_Click"
                                    Style="{DynamicResource Carbon.Button.Secondary}"
                                    Margin="0,0,10,0"/>
                            <Button Content="Refresh Statistics" 
                                    Click="RefreshStatistics_Click"
                                    Style="{DynamicResource Carbon.Button.Secondary}"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>

                <!-- Quick Actions -->
                <GroupBox Header="Quick Actions">
                    <StackPanel Margin="5">
                        <StackPanel Orientation="Horizontal">
                            <Button Content="Test Error Log" 
                                    Click="TestErrorLog_Click"
                                    Style="{DynamicResource Carbon.Button.Secondary}"
                                    Margin="0,0,10,0"/>
                            <Button Content="Test Usage Analytics" 
                                    Click="TestUsageAnalytics_Click"
                                    Style="{DynamicResource Carbon.Button.Secondary}"
                                    Margin="0,0,10,0"/>
                            <Button Content="Export Configuration" 
                                    Click="ExportConfiguration_Click"
                                    Style="{DynamicResource Carbon.Button.Secondary}"/>
                        </StackPanel>
                        
                        <TextBlock Text="Use these buttons to test the logging system and verify configuration."
                                   TextWrapping="Wrap"
                                   Foreground="{DynamicResource Carbon.Brush.Text.Secondary}"
                                   Margin="0,10,0,0"
                                   FontSize="11"/>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>

        <StackPanel Grid.Row="1" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right" 
                    Margin="0,10,0,0">
            <Button Content="Cancel"
                    Style="{DynamicResource Carbon.Button.Secondary}"
                    Click="CancelButton_Click"
                    MinWidth="100"
                    Margin="0,0,12,0"/>
            
            <Button Content="Apply"
                    Style="{DynamicResource Carbon.Button.Secondary}"
                    Click="ApplyButton_Click"
                    MinWidth="100"
                    Margin="0,0,12,0"/>
            
            <Button Content="Save"
                    Style="{DynamicResource Carbon.Button.Base}"
                    Click="SaveButton_Click"
                    MinWidth="100"/>
        </StackPanel>
    </Grid>
</Window>